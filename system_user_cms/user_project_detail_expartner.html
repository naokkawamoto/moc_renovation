<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>案件管理（現地調査） - 外部協力会社依頼</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css" rel="stylesheet"/>
    <style>
        /* 全体左右マージン */
        .content-wrapper {
            margin: 0 auto;
            padding: 0 1rem;
        }
        /* カードを小さく */
        .card-project {
            font-size: 0.75rem;
        }
        .card-project .card-header {
            padding: 0.4rem 0.6rem;
        }
        .card-project .card-body {
            padding: 0.5rem;
        }
        .card-project .btn {
            font-size: 0.8rem;
            padding: 0.4rem 0.6rem;
        }
    </style>
</head>
<body>
    <!-- ヘッダー -->
    <div id="header-container"></div>

    <div class="content-wrapper mt-4">
        <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
                <h5 class="mb-0">会社名</h5>
                <h4 class="mb-0 d-inline">案件名 <i class="bi bi-star"></i></h4>
            </div>
            <div class="text-end">
                <span class="me-2">案件フロー:</span>
                <select class="form-select form-select-sm me-2" style="width:auto; display:inline-block;">
                    <option value="registration">案件登録中</option>
                    <option value="investigate">現地調査中</option>
                    <option value="design">プラン中</option>
                    <option value="estimate">提案完了</option>
                    <option value="estimate">契約完了</option>
                    <option value="estimate">終了</option>
                    </select>
                    <button class="btn btn-outline-primary btn-sm">変更</button>
                </div>
                </div>
            
                <!-- ワークフローバッジ -->
                <div class="d-flex justify-content-end mb-3">
                    <span class="badge bg-light text-dark me-2">案件登録中</span>
                    <span class="badge bg-light text-dark me-2">現地調査中</span>
                    <span class="badge bg-light text-dark me-2">プラン中</span>
                    <span class="badge bg-light text-dark me-2">提案完了</span>
                    <span class="badge bg-primary me-2">契約完了</span>
                    <span class="badge bg-light text-dark me-2">終了</span>
                </div>

        <!-- ナビゲーションタブ -->
        <ul class="nav nav-tabs mb-4">
            <li class="nav-item"><a class="nav-link" href="user_project_detail.html">概要</a></li>
            <li class="nav-item"><a class="nav-link" href="user_project_detail_investigate.html">現地調査</a></li>
            <li class="nav-item"><a class="nav-link" href="user_project_detail_designlist.html">プラン一覧</a></li>
            <li class="nav-item"><a class="nav-link" href="user_project_detail_doc.html">お客様資料</a></li>
            <li class="nav-item"><a class="nav-link" href="user_project_detail_chat.html">チャット <span class="badge bg-danger">5</span></a></li>
            <li class="nav-item"><a class="nav-link active" href="user_project_detail_expartner.html">外部業務依頼<span class="badge bg-danger">3</span></a></li>
        </ul>

        <!-- 外部協力会社依頼セクション -->
        <h3 class="mb-3">外部協力会社依頼</h3>
        <div class="card">
            <div class="card-header">
                <span>外部専門家</span>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover table-bordered small-text">
                        <thead class="table-light">
                            <tr>
                                <th>職種</th>
                                <th>会社名</th>
                                <th>名前</th>
                                <th>名前（カナ）</th>
                                <th>メール</th>
                                <th>電話番号</th>
                                <th>チャット</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>家屋調査士</td>
                                <td>株式会社専門一</td>
                                <td>松本 桜</td>
                                <td>マツモト サクラ</td>
                                <td>sakura.matsumoto@example.com</td>
                                <td>090-2345-0001</td>
                                <td><button class="btn btn-primary btn-sm">家屋調査士とチャット</button><span class="badge bg-danger">5</span></td>
                            </tr>
                            <tr>
                                <td>司法書士</td>
                                <td>株式会社専門二</td>
                                <td>小川 翔</td>
                                <td>オガワ ショウ</td>
                                <td>sho.ogawa@example.com</td>
                                <td>090-2345-0002</td>
                                <td><button class="btn btn-primary btn-sm">司法書士とチャット</button><span class="badge bg-danger">3</span></td>
                            </tr>
                            <tr>
                                <td>建築士</td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td><button class="btn btn-danger btn-sm">追加</button></td>
                            </tr>
                            <tr>
                                <td>インテリアコーディネーター</td>
                                <td>株式会社専門四</td>
                                <td>橋本 健太</td>
                                <td>ハシモト ケンタ</td>
                                <td>kenta.hashimoto@example.com</td>
                                <td>090-2345-0004</td>
                                <td><button class="btn btn-primary btn-sm">ICとチャット</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- フッター -->
    <div id="footer-container"></div>

    <!-- チャット開始モーダル -->
    <div class="modal fade" id="chatStartModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">チャットを開始</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">チャットタイトル</label>
                        <input type="text" class="form-control" id="chatTitle" value="案件名：登記について">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">メンバーを追加</label>
                        <div id="memberList">
                            <div class="d-flex align-items-center mb-2">
                                <span id="memberName" class="me-2"></span>
                                <span id="memberRole" class="badge bg-primary"></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
                    <button type="button" class="btn btn-primary" id="startChatBtn">チャットを開始する</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 専門家追加モーダル -->
    <div class="modal fade" id="addExpertModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">専門家を追加</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="addExpertForm">
                        <div class="mb-3">
                            <label class="form-label">会社名</label>
                            <input type="text" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">名前</label>
                            <input type="text" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">名前（カナ）</label>
                            <input type="text" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">メール</label>
                            <input type="email" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">電話番号</label>
                            <input type="tel" class="form-control" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">キャンセル</button>
                    <button type="button" class="btn btn-primary" id="addExpertBtn">追加</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- カスタムスクリプト -->
    <script src="../style.js"></script>
    <script>
        fetch('user_header.html').then(r => r.text()).then(html => document.getElementById('header-container').innerHTML = html);
        fetch('user_footer.html').then(r => r.text()).then(html => document.getElementById('footer-container').innerHTML = html);

        // チャットモーダル関連の処理
        document.addEventListener('DOMContentLoaded', function() {
            const chatStartModal = new bootstrap.Modal(document.getElementById('chatStartModal'));
            const addExpertModal = new bootstrap.Modal(document.getElementById('addExpertModal'));

            // 家屋調査士と司法書士のチャットボタン
            document.querySelectorAll('.btn-primary').forEach(button => {
                if (button.textContent.includes('チャット')) {
                    button.addEventListener('click', function() {
                        const role = this.textContent.split('と')[0];
                        const name = this.closest('tr').querySelector('td:nth-child(3)').textContent;
                        document.getElementById('memberName').textContent = name;
                        document.getElementById('memberRole').textContent = role;
                        chatStartModal.show();
                    });
                }
            });

            // ICとチャットボタン
            document.querySelector('.btn-primary:contains("ICとチャット")').addEventListener('click', function() {
                document.getElementById('memberName').textContent = 'サンプル名';
                document.getElementById('memberRole').textContent = '施主様';
                chatStartModal.show();
            });

            // 追加ボタン
            document.querySelector('.btn-danger').addEventListener('click', function() {
                addExpertModal.show();
            });

            // チャット開始ボタン
            document.getElementById('startChatBtn').addEventListener('click', function() {
                // ここにチャット開始の処理を追加
                chatStartModal.hide();
            });

            // 専門家追加ボタン
            document.getElementById('addExpertBtn').addEventListener('click', function() {
                // ここに専門家追加の処理を追加
                addExpertModal.hide();
            });
        });
    </script>
</body>
</html>
