<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>システム設定</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- Bootstrap CSS (5系) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    
    <!-- カスタムCSS -->
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <!-- ヘッダー -->
    <div id="header-container"></div>
  
    <div class="container-fluid mt-4">
      <!-- ページタイトル -->
      <h3 class="mb-3">分析</h3>
      <h5 class="text-muted mb-4">アンケート分析とそのほかの分析</h5>
      <div class="tab-content">
        <!-- 概要タブ -->
        <div class="tab-pane fade show active" id="overview">
          <div class="p-3">
            <ul class="nav nav-tabs mb-3" id="overviewSubTabs" role="tablist">
              <li class="nav-item" role="presentation">
                <button class="nav-link active" id="sub-project-tab" data-bs-toggle="tab" data-bs-target="#sub-project" type="button" role="tab" aria-controls="sub-project" aria-selected="true">案件分析</button>
              </li>
              <li class="nav-item" role="presentation">
                <button class="nav-link" id="sub-questionary-tab" data-bs-toggle="tab" data-bs-target="#sub-questionary" type="button" role="tab" aria-controls="sub-questionary" aria-selected="false">アンケート分析</button>
              </li>
              
            </ul>

            <div class="tab-content">
              <!-- 案件分析 -->
              <div class="tab-pane fade show active" id="sub-project" role="tabpanel" aria-labelledby="sub-project-tab">
                <div class="card mb-3">
                  <div class="card-header d-flex justify-content-between">
                    <span>案件分析</span>
                    <button type="button" class="btn btn-sm btn-outline-secondary">編集</button>
                  </div>
                  <div class="card-body">
                    
                  </div>
                </div>
              </div>

              <!-- アンケート分析 -->
              <div class="tab-pane fade" id="sub-questionary" role="tabpanel" aria-labelledby="sub-questionary-tab">
                <div class="card mb-3">
                  <div class="card-header d-flex justify-content-between">
                    <span>アンケート分析</span>
                    <button type="button" class="btn btn-sm btn-outline-secondary">編集</button>
                  </div>
                  <div class="card-body">
                    <!-- 分析条件設定 -->
                    <form id="questionnaireAnalysisForm">
                      <!-- アンケート選択 -->
                      <div class="row mb-3">
                        <div class="col-12">
                          <label class="form-label fw-bold">アンケート選択</label>
                          <div class="d-flex flex-wrap gap-3">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="questionnaire" id="q0001" value="0001" checked>
                              <label class="form-check-label" for="q0001">ID0001 住まいに関する悩み</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="questionnaire" id="q0002" value="0002">
                              <label class="form-check-label" for="q0002">ID0002 平日と休日の生活について</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="questionnaire" id="q0003" value="0003">
                              <label class="form-check-label" for="q0003">ID0003 建築家設計希望 間取り・ゾーニング・部屋数</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="questionnaire" id="q0004" value="0004">
                              <label class="form-check-label" for="q0004">ID0004 予算に関するヒアリングシート</label>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- フィルター条件 -->
                      <div class="row mb-3">
                        <div class="col-md-4">
                          <label class="form-label fw-bold">対象範囲</label>
                          <div class="d-flex flex-column gap-2">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="scope" id="filter-all" value="all" checked>
                              <label class="form-check-label" for="filter-all">全社</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="scope" id="filter-branch" value="branch">
                              <label class="form-check-label" for="filter-branch">支店別</label>
                            </div>
                          </div>
                          
                          <!-- 支店選択（支店別が選択された時のみ表示） -->
                          <div id="branchSelection" class="mt-2" style="display: none;">
                            <label class="form-label fw-bold">支店名</label>
                            <div class="d-flex flex-column gap-2">
                              <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="branch-tokyo" value="tokyo">
                                <label class="form-check-label" for="branch-tokyo">東京支店</label>
                              </div>
                              <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="branch-osaka" value="osaka">
                                <label class="form-check-label" for="branch-osaka">大阪支店</label>
                              </div>
                              <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="branch-nagoya" value="nagoya">
                                <label class="form-check-label" for="branch-nagoya">名古屋支店</label>
                              </div>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-4">
                          <label class="form-label fw-bold">物件種別</label>
                          <div class="d-flex flex-column gap-2">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="property" id="property-house" value="house" checked>
                              <label class="form-check-label" for="property-house">戸建て</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="property" id="property-office" value="office">
                              <label class="form-check-label" for="property-office">オフィス</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="property" id="property-shop" value="shop">
                              <label class="form-check-label" for="property-shop">店舗</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="property" id="property-apartment" value="apartment">
                              <label class="form-check-label" for="property-apartment">アパート</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="property" id="property-other" value="other">
                              <label class="form-check-label" for="property-other">その他</label>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-4">
                          <label class="form-label fw-bold">工事区分</label>
                          <div class="d-flex flex-column gap-2">
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="work" id="work-new" value="new" checked>
                              <label class="form-check-label" for="work-new">新築</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="work" id="work-existing" value="existing">
                              <label class="form-check-label" for="work-existing">既存住宅</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="work" id="work-used-purchase" value="used-purchase">
                              <label class="form-check-label" for="work-used-purchase">中古住宅購入</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="work" id="work-existing-mansion" value="existing-mansion">
                              <label class="form-check-label" for="work-existing-mansion">既存マンション</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="work" id="work-used-mansion" value="used-mansion">
                              <label class="form-check-label" for="work-used-mansion">中古マンション購入</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="work" id="work-rental" value="rental">
                              <label class="form-check-label" for="work-rental">賃貸物件</label>
                            </div>
                            <div class="form-check">
                              <input class="form-check-input" type="radio" name="work" id="work-other" value="other">
                              <label class="form-check-label" for="work-other">その他</label>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- 集計期間 -->
                      <div class="row mb-4">
                        <div class="col-12">
                          <label class="form-label fw-bold">集計期間</label>
                          <div class="d-flex align-items-center gap-3">
                            <div class="d-flex align-items-center gap-2">
                              <label class="form-label mb-0">開始月:</label>
                              <select class="form-select form-select-sm" style="width: 120px;" id="startMonth">
                                <option value="2024-01">2024年1月</option>
                                <option value="2024-02">2024年2月</option>
                                <option value="2024-03">2024年3月</option>
                                <option value="2024-04">2024年4月</option>
                                <option value="2024-05">2024年5月</option>
                                <option value="2024-06">2024年6月</option>
                                <option value="2024-07">2024年7月</option>
                                <option value="2024-08">2024年8月</option>
                                <option value="2024-09">2024年9月</option>
                                <option value="2024-10">2024年10月</option>
                                <option value="2024-11">2024年11月</option>
                                <option value="2024-12">2024年12月</option>
                                <option value="2025-01" selected>2025年1月</option>
                                <option value="2025-02">2025年2月</option>
                                <option value="2025-03">2025年3月</option>
                                <option value="2025-04">2025年4月</option>
                                <option value="2025-05">2025年5月</option>
                                <option value="2025-06">2025年6月</option>
                              </select>
                            </div>
                            <span>～</span>
                            <div class="d-flex align-items-center gap-2">
                              <label class="form-label mb-0">終了月:</label>
                              <select class="form-select form-select-sm" style="width: 120px;" id="endMonth">
                                <option value="2024-01">2024年1月</option>
                                <option value="2024-02">2024年2月</option>
                                <option value="2024-03">2024年3月</option>
                                <option value="2024-04">2024年4月</option>
                                <option value="2024-05">2024年5月</option>
                                <option value="2024-06">2024年6月</option>
                                <option value="2024-07">2024年7月</option>
                                <option value="2024-08">2024年8月</option>
                                <option value="2024-09">2024年9月</option>
                                <option value="2024-10">2024年10月</option>
                                <option value="2024-11">2024年11月</option>
                                <option value="2024-12">2024年12月</option>
                                <option value="2025-01">2025年1月</option>
                                <option value="2025-02">2025年2月</option>
                                <option value="2025-03" selected>2025年3月</option>
                                <option value="2025-04">2025年4月</option>
                                <option value="2025-05">2025年5月</option>
                                <option value="2025-06">2025年6月</option>
                              </select>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- 集計ボタン -->
                      <div class="row mb-4">
                        <div class="col-12">
                          <button type="button" class="btn btn-primary" onclick="analyzeQuestionnaire()">
                            <i class="bi bi-graph-up"></i> 集計実行
                          </button>
                        </div>
                      </div>
                    </form>

                    <!-- 分析結果 -->
                    <div id="analysisResults" style="display: none;">
                      <hr>
                      <h5 class="mb-3">分析結果</h5>
                      
                      <!-- アンケート0001の結果 -->
                      <div class="card mb-3">
                        <div class="card-header">
                          <h6 class="mb-0">ID0001 住まいに関する悩み ヒアリングシート</h6>
                        </div>
                        <div class="card-body">
                          <div class="row">
                            <div class="col-md-6">
                              <h6>1. 空間に関する悩み</h6>
                              <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                  <span>部屋が狭い・広すぎる</span>
                                  <span class="badge bg-primary">45.2%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                  <div class="progress-bar" style="width: 45.2%"></div>
                                </div>
                              </div>
                              <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                  <span>動線（家事、生活動線）が悪い</span>
                                  <span class="badge bg-primary">38.7%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                  <div class="progress-bar" style="width: 38.7%"></div>
                                </div>
                              </div>
                              <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                  <span>収納スペースが足りない・使いにくい</span>
                                  <span class="badge bg-primary">52.1%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                  <div class="progress-bar" style="width: 52.1%"></div>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <h6>2. 快適性に関する悩み</h6>
                              <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                  <span>冬は寒く、夏は暑い</span>
                                  <span class="badge bg-success">67.3%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                  <div class="progress-bar bg-success" style="width: 67.3%"></div>
                                </div>
                              </div>
                              <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                  <span>風通しが悪い（湿気がこもる）</span>
                                  <span class="badge bg-success">41.8%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                  <div class="progress-bar bg-success" style="width: 41.8%"></div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- アンケート0002の結果 -->
                      <div class="card mb-3">
                        <div class="card-header">
                          <h6 class="mb-0">ID0002 平日と休日の生活についてのヒアリングシート</h6>
                        </div>
                        <div class="card-body">
                          <div class="row">
                            <div class="col-md-6">
                              <h6>平日の生活パターン</h6>
                              <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                  <span>朝6時前起床</span>
                                  <span class="badge bg-info">28.5%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                  <div class="progress-bar bg-info" style="width: 28.5%"></div>
                                </div>
                              </div>
                              <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                  <span>朝6-8時起床</span>
                                  <span class="badge bg-info">58.2%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                  <div class="progress-bar bg-info" style="width: 58.2%"></div>
                                </div>
                              </div>
                            </div>
                            <div class="col-md-6">
                              <h6>休日の過ごし方</h6>
                              <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                  <span>家族との時間</span>
                                  <span class="badge bg-warning">72.4%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                  <div class="progress-bar bg-warning" style="width: 72.4%"></div>
                                </div>
                              </div>
                              <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                  <span>趣味・リラックスタイム</span>
                                  <span class="badge bg-warning">45.7%</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                  <div class="progress-bar bg-warning" style="width: 45.7%"></div>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!-- サマリー統計 -->
                      <div class="card">
                        <div class="card-header">
                          <h6 class="mb-0">サマリー統計</h6>
                        </div>
                        <div class="card-body">
                          <div class="row text-center">
                            <div class="col-md-3">
                              <div class="border rounded p-3">
                                <h4 class="text-primary mb-1">1,247</h4>
                                <small class="text-muted">総回答数</small>
                              </div>
                            </div>
                            <div class="col-md-3">
                              <div class="border rounded p-3">
                                <h4 class="text-success mb-1">89.3%</h4>
                                <small class="text-muted">回答率</small>
                              </div>
                            </div>
                            <div class="col-md-3">
                              <div class="border rounded p-3">
                                <h4 class="text-info mb-1">156</h4>
                                <small class="text-muted">対象案件数</small>
                              </div>
                            </div>
                            <div class="col-md-3">
                              <div class="border rounded p-3">
                                <h4 class="text-warning mb-1">3.2</h4>
                                <small class="text-muted">平均回答時間（分）</small>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>



  </div>
    <!-- フッター -->
    <div id="footer-container"></div>
  
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- カスタムスクリプト -->
    <script src="../style.js"></script>
    <script>
      // ヘッダー・フッター読み込み
      fetch('user_header.html').then(r=>r.text()).then(html=>document.getElementById('header-container').innerHTML=html);
      fetch('user_footer.html').then(r=>r.text()).then(html=>document.getElementById('footer-container').innerHTML=html);
  
      // ページ読み込み時の初期化
      document.addEventListener('DOMContentLoaded', function() {
        // 対象範囲のラジオボックス変更時の処理
        const scopeRadios = document.querySelectorAll('input[name="scope"]');
        scopeRadios.forEach(radio => {
          radio.addEventListener('change', function() {
            const branchSelection = document.getElementById('branchSelection');
            if (this.value === 'branch') {
              branchSelection.style.display = 'block';
            } else {
              branchSelection.style.display = 'none';
              // 支店選択をクリア
              document.querySelectorAll('input[id^="branch-"]').forEach(checkbox => {
                checkbox.checked = false;
              });
            }
          });
        });
      });
  
      // アンケート分析機能
      function analyzeQuestionnaire() {
        // 選択されたアンケートを取得
        const selectedQuestionnaire = document.querySelector('input[name="questionnaire"]:checked');
        
        if (!selectedQuestionnaire) {
          alert('アンケートを1つ選択してください。');
          return;
        }

        const selectedQuestionnaires = [selectedQuestionnaire.value];

        // 選択されたフィルター条件を取得
        const selectedFilters = {
          scope: [],
          property: [],
          work: [],
          branches: []
        };

        // 対象範囲
        const selectedScope = document.querySelector('input[name="scope"]:checked');
        if (selectedScope) {
          selectedFilters.scope.push(selectedScope.value);
        }

        // 物件種別
        const selectedProperty = document.querySelector('input[name="property"]:checked');
        if (selectedProperty) {
          selectedFilters.property.push(selectedProperty.value);
        }

        // 工事区分
        const selectedWork = document.querySelector('input[name="work"]:checked');
        if (selectedWork) {
          selectedFilters.work.push(selectedWork.value);
        }

        // 支店選択（支店別が選択されている場合）
        if (selectedScope && selectedScope.value === 'branch') {
          document.querySelectorAll('input[id^="branch-"]:checked').forEach(checkbox => {
            selectedFilters.branches.push(checkbox.value);
          });
        }

        // 集計期間
        const startMonth = document.getElementById('startMonth').value;
        const endMonth = document.getElementById('endMonth').value;

        // バリデーション
        if (selectedFilters.scope.length === 0) {
          alert('対象範囲を選択してください。');
          return;
        }

        if (selectedFilters.property.length === 0) {
          alert('物件種別を選択してください。');
          return;
        }

        if (selectedFilters.work.length === 0) {
          alert('工事区分を選択してください。');
          return;
        }

        // 支店別が選択されている場合、支店を1つ以上選択する必要がある
        if (selectedScope && selectedScope.value === 'branch' && selectedFilters.branches.length === 0) {
          alert('支店を1つ以上選択してください。');
          return;
        }

        if (new Date(startMonth) > new Date(endMonth)) {
          alert('開始月は終了月より前の月を選択してください。');
          return;
        }

        // ローディング表示
        const analyzeButton = document.querySelector('button[onclick="analyzeQuestionnaire()"]');
        const originalText = analyzeButton.innerHTML;
        analyzeButton.innerHTML = '<i class="bi bi-hourglass-split"></i> 集計中...';
        analyzeButton.disabled = true;

        // シミュレーション（実際のAPI呼び出しの代わり）
        setTimeout(() => {
          // 分析結果を表示
          document.getElementById('analysisResults').style.display = 'block';
          
          // ボタンを元に戻す
          analyzeButton.innerHTML = originalText;
          analyzeButton.disabled = false;

          // 結果までスクロール
          document.getElementById('analysisResults').scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
          });

          // 選択条件の表示
          showSelectedConditions(selectedQuestionnaires, selectedFilters, startMonth, endMonth);
        }, 2000);
      }

      // 選択条件の表示
      function showSelectedConditions(questionnaires, filters, startMonth, endMonth) {
        const resultsDiv = document.getElementById('analysisResults');
        
        // 支店名の表示用
        let scopeDisplay = filters.scope.map(s => s === 'all' ? '全社' : '支店別').join(', ');
        if (filters.scope.includes('branch') && filters.branches.length > 0) {
          const branchNames = {
            'tokyo': '東京支店',
            'osaka': '大阪支店',
            'nagoya': '名古屋支店'
          };
          const selectedBranches = filters.branches.map(b => branchNames[b] || b).join(', ');
          scopeDisplay += ` (${selectedBranches})`;
        }
        
        const conditionsHtml = `
          <div class="alert alert-info mb-3">
            <h6 class="mb-2">選択された条件</h6>
            <div class="row">
              <div class="col-md-3">
                <strong>アンケート:</strong><br>
                ${questionnaires.map(q => {
                  const names = {
                    '0001': 'ID0001 住まいに関する悩み',
                    '0002': 'ID0002 平日と休日の生活について',
                    '0003': 'ID0003 建築家設計希望',
                    '0004': 'ID0004 予算に関するヒアリングシート'
                  };
                  return names[q] || q;
                }).join('<br>')}
              </div>
              <div class="col-md-3">
                <strong>対象範囲:</strong><br>
                ${scopeDisplay}
              </div>
              <div class="col-md-3">
                <strong>物件種別:</strong><br>
                ${filters.property.map(p => {
                  const names = {
                    'house': '戸建て',
                    'office': 'オフィス',
                    'shop': '店舗',
                    'apartment': 'アパート',
                    'other': 'その他'
                  };
                  return names[p] || p;
                }).join('<br>')}
              </div>
              <div class="col-md-3">
                <strong>工事区分:</strong><br>
                ${filters.work.map(w => {
                  const names = {
                    'new': '新築',
                    'existing': '既存住宅',
                    'used-purchase': '中古住宅購入',
                    'existing-mansion': '既存マンション',
                    'used-mansion': '中古マンション購入',
                    'rental': '賃貸物件',
                    'other': 'その他'
                  };
                  return names[w] || w;
                }).join('<br>')}
              </div>
            </div>
            <div class="mt-2">
              <strong>集計期間:</strong> ${startMonth} ～ ${endMonth}
            </div>
          </div>
        `;
        
        // 既存の条件表示があれば削除
        const existingAlert = resultsDiv.querySelector('.alert-info');
        if (existingAlert) {
          existingAlert.remove();
        }
        
        // 新しい条件表示を挿入
        resultsDiv.insertAdjacentHTML('afterbegin', conditionsHtml);
      }
    </script>
  </body>
</html>
